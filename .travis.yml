language: python
sudo: required

branches:
  only:
    - master

services:
  - docker

matrix:
  include:
    # all CIBW_SKIP-globs are intended to match exclosures,
    # i.e. platform tags to exclude from the generation
    - python: "3.6"
      os: linux

before_install:
  - sudo apt-get update -qq

install:
  - pip install six
  - pip install cython numpy scipy --use-wheel
  - |
    if [[ "$TRAVIS_PYTHON_VERSION" == "3.6" ]] ; then
      pip install coverage coveralls --use-wheel
    fi

script:
  - echo "Running build for $TRAVIS_PYTHON_VERSION"
  - make compile-coverage
  - |
    if [[ "$TRAVIS_PYTHON_VERSION" == "3.6" ]] ; then
      echo "Running coverage analysis..."
      coverage run --source=fastmat util/bee.py list makedump
      coverage run -a --source=fastmat util/bee.py test -v
      coverage run -a --source=fastmat util/bee.py benchmark maxIter=0.001 maxInit=0.01 minItems=1
      coverage run -a --source=fastmat util/bee.py documentation
      coverage run -a --source=fastmat util/bee.py calibrate
    else
      echo "Running regular test set..."
      python util/bee.py test -v
    fi

after_success: >
  - echo "Finished job for $TRAVIS_PYTHON_VERSION successfully."
  - |
    if [[ "$TRAVIS_PYTHON_VERSION" == "3.6" ]] ; then
      echo "Submitting coverage analysis results..."
      coveralls
    fi
