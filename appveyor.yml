environment:
  global:
    PYTHON: "C:\\conda"
    MINICONDA_VERSION: "latest"
    CMD_IN_ENV: "cmd /E:ON /V:ON /C .\\ci-helpers\\appveyor\\windows_sdk.cmd"
    CONDA_DEPENDENCIES: "numpy scipy"
    PIP_DEPENDENCIES: "six"
    CIBW_TEST_COMMAND: "python {project}/util/bee.py test -v"
 
  matrix:
    - PYTHON_VERSION: "3.6"

    - PYTHON_VERSION: "3.5"
      SKIP_NOTAG: true

    - PYTHON_VERSION: "3.4"
      SKIP_NOTAG: true

    - PYTHON_VERSION: "2.7"

    - PYTHON_VERSION: "3.6"
      SKIP_NOTAG: true

    - PYTHON_VERSION: "3.5"
      SKIP_NOTAG: true

    - PYTHON_VERSION: "3.4"
      SKIP_NOTAG: true

    - PYTHON_VERSION: "2.7"
      SKIP_NOTAG: true

platform:
  - x86
  - x64

init:
  - "ECHO %PYTHON% %PYTHON_VERSION% %PYTHON_ARCH%"
  - "ECHO \"%APPVEYOR_SCHEDULED_BUILD%\""

install:
  - "powershell ci-helpers/appveyor/install-miniconda.ps1"
  - "SET PATH=%PYTHON%;%PYTHON%\\Scripts;%PATH%"
  - "ECHO %PYTHON% %PYTHON_VERSION% %PYTHON_ARCH%"
  - "ECHO \"%APPVEYOR_SCHEDULED_BUILD%\""

  # Check that we have the expected version and architecture for Python
  - python --version
  - >-
     %CMD_IN_ENV%
     python -c "import sys,platform,struct;
     print(sys.platform, platform.machine(), struct.calcsize('P') * 8, )"

build_script:
  - pip install cibuildwheel==0.5.1
  - "%CMD_IN_ENV% python setup.py build_ext --inplace"

test_script:
  - "%CMD_IN_ENV% python util/bee.py test -v"
  - cibuildwheel --output-dir wheelhouse

artifacts:
  - path: "wheelhouse\\*.whl"
    name: Wheels
